<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Where does IP data come from?</title>
  <meta name="description" content="I’ve wondered for quite some time, how do sites like https://ipinfo.io get their data? Secondly, the question I had was “Could I gather/build out the data us...">
  <link href="https://fonts.googleapis.com/css?family=Heebo:400,700,900" rel="stylesheet">
  <link rel="stylesheet" href="/assets/main.css?h=a320946%0A">
  <link rel="canonical" href="http://ahermosilla.com/tools/2020/07/07/where-ip-data-lives.html">
  <link rel="alternate" type="application/rss+xml" title="Andres Hermosilla | brain --archive" href="/feed.xml">
  
  
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-33398574-1', 'auto');
  ga('send', 'pageview');

</script>
  

  
</head>
  <body>
    <header class="site-header" role="banner">
  <div class="wrapper">
    <span class="post-path">
      <a href="/">2020-07-07-where-ip-data-lives.md</a>
    </span>
    <nav class="site-nav">
      <a class="menu-trigger">Menu</a>
      <div class="menu-items">
        
          <a class="page-link" href="/">/root</a>
        
          <a class="page-link" href="/about/">/about</a>
        
          <a class="page-link" href="/categories/">/categories</a>
        
          <a class="page-link" href="/tags/">/tags</a>
        
      </div>
    </nav>
  </div>
</header>

    <main class="page-content">
      <div class="wrapper" aria-label="Content">
        <article id="post-where-ip-data-lives" class="post post-single category-toolstag-ip" itemscope itemtype="http://schema.org/BlogPosting">
  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">Where does IP data come from?</h1>
    <section class="post-meta">
      
      <time class="post-date" datetime="2020-07-07T00:00:00+00:00" itemprop="datePublished">
        July 07, 2020
      </time>



      
        


<ul class="tag-links topic-links">
	
	
    <li class="tag-link-item"><a href="/tags/ip/">ip</a></li>
    
</ul>
      
    </section>
  </header>
  <section class="post-content" itemprop="articleBody">
    
    <p>I’ve wondered for quite some time, how do sites like <a href="https://ipinfo.io">https://ipinfo.io</a> get their data? Secondly, the question I had was “Could I gather/build out the data used by these sorts of services?”. Off the bat, looking at the data, I made the assumption that the ownership data is stored publicly or “premiumly” that I could access, but where? So I did some digging around and below is some the datasets I discovered.</p>

<h2 id="iana">IANA</h2>
<p>ICANN runs IANA which allocates IP addresses globally. The IANA allocates blocks of IPs to RIRs (Regional Internet Registry) which manage the blocks allocated to them. You can view the list of ranges and how they are allocated here <a href="https://www.iana.org/assignments/ipv4-address-space/ipv4-address-space.xhtml">https://www.iana.org/assignments/ipv4-address-space/ipv4-address-space.xhtml</a>. It seems they allocate  <code class="language-plaintext highlighter-rouge">/8</code> ranges, which you can also see here <a href="https://en.wikipedia.org/wiki/List_of_assigned_/8_IPv4_address_blocks">https://en.wikipedia.org/wiki/List_of_assigned_/8_IPv4_address_blocks</a></p>

<h2 id="rir">RIR</h2>
<p>The RIR is a regional registry (RIPE, APNIC, ARIN, LACNIC, NRO, AFRINIC) and you can see the <a href="https://en.wikipedia.org/wiki/Regional_Internet_registry#/media/File:Regional_Internet_Registries_world_map.svg">map here</a>. Each RIR will further allocate addresses to a LIR.</p>

<h2 id="asn">ASN</h2>
<p>So with that knowledge, I dug down into each RIR to see where I could possibly mine the allocated addresses. I found there were dumps of data which took me some time to look through to find what datasets would be helpful. In the process of looking at ARIN datasets I ran across the term <a href="https://en.wikipedia.org/wiki/Autonomous_system_(Internet)">ASN</a>. ASNs are assigned by the IANA to each RIR which assign those the ASNs to a block.
You can see all the assigments here <a href="https://www.iana.org/assignments/as-numbers/as-numbers.xhtml">https://www.iana.org/assignments/as-numbers/as-numbers.xhtml</a></p>

<p>So you can get the list of ASN details from each RIR. It did notice RIPE had the details for every RIR (<a href="https://ftp.ripe.net/pub/stats/">https://ftp.ripe.net/pub/stats/</a>
) so you don’t necessarily have to go to every RIR to get that data. Using the data I could figure out what ranges and ASNs belonged together.</p>

<ul>
  <li>Get all ASNs
    <ul>
      <li><a href="https://ftp.ripe.net/ripe/asnames/asn.txt">https://ftp.ripe.net/ripe/asnames/asn.txt</a></li>
    </ul>
  </li>
  <li>Get a list of ASNs for ARIN
    <ul>
      <li><a href="ftp://ftp.arin.net/info/asn.txt">ftp://ftp.arin.net/info/asn.txt</a></li>
    </ul>
  </li>
  <li>Get ASNs &amp; ranges for ARIN
    <ul>
      <li><a href="http://ftp.arin.net/pub/stats/arin/delegated-arin-extended-latest">http://ftp.arin.net/pub/stats/arin/delegated-arin-extended-latest</a></li>
    </ul>
  </li>
  <li>Get a specific ASN
    <ul>
      <li><a href="https://rdap.arin.net/registry/autnum/15169">https://rdap.arin.net/registry/autnum/15169</a></li>
    </ul>
  </li>
  <li>Use whois to get ranges for an ASN
    <ul>
      <li><code class="language-plaintext highlighter-rouge">whois -h whois.radb.net -- '-i origin AS714' | grep -Eo "([0-9.]+){4}/[0-9]+" | head</code></li>
    </ul>
  </li>
</ul>

<p>For verification that the data was good, I looked up some addresses at IP info to see if things checked out, and everything looked good, but there was some caveats. I looked up some of the ranges and they were noted as inactive. How did I know a given range was “inactive”, there were not clear indicators in the ARIN datasets?</p>

<p>Another challenge was associating ranges to a specific ASN. You can use the <code class="language-plaintext highlighter-rouge">reg-id</code> column to tie ASNs and IPs under the same org, but it isn’t clear how to tie an ASN to a specific IP allocation.</p>

<h3 id="stats-delegated-format">Stats delegated format</h3>
<p>Looking at the delegated extended datasets, they look like this.</p>

<pre><code class="language-2.3|arin|1594044013396|154725|19700101|20200706|-0400">arin|*|asn|*|28470|summary
arin|*|ipv4|*|66069|summary
arin|*|ipv6|*|60186|summary
arin|US|asn|1|1|20010920|assigned|e5e3b9c13678dfc483fb1f819d70883c
arin|US|asn|2|1|19910110|assigned|c3a16289a7ed6fb75fec2e256e5b5101
arin|US|asn|3|1|00000000|assigned|d98c567cda2db06e693f2b574eafe848
arin|US|asn|4|1|19840222|assigned|8c3f2df306a67e97a7abb5a2a0335865
arin|US|asn|5|1|19840202|assigned|17758c838b246924a54466f28f2b45ef
arin|US|asn|6|1|19840202|assigned|481b80475499335d51156e7b72507568
arin|US|asn|8|1|19840326|assigned|5f676a1dae02fc7cb708558c3ff1d122
arin|US|asn|9|1|19840417|assigned|859ff8395a142b506a4aa4425d450e1d
arin|US|asn|10|1|00000000|assigned|3fa2e5aa48f205a7696ea6fbcd437cff
arin|US|asn|11|1|19840704|assigned|88e9e1a9f78221c5b97e72d580642205
</code></pre>

<p>It look me awhile to decipher the format, especially the last column, but this is the gist of it (I finally found a doc on the <a href="https://www.arin.net/reference/research/statistics/nro_extended_stats_format.pdf">format</a>). The last column essentially is a key to help you associate rows with a given org.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>registry|country_code|type|start|value|date|status|reg-­‐id[|extensions...]
</code></pre></div></div>

<h2 id="bgp">BGP</h2>
<p>During my research process, verifying information about ranges and ownership I ran into <a href="https://bgp.he.net/AS3356">https://bgp.he.net/AS3356</a>. BGP (which I won’t dig into because I haven’t take the time yet to understand) is a protcol for exchanging routing information. I found you can download dumps of the exchanges and parse through them. Inside those dumps (<a href="http://archive.routeviews.org/bgpdata/">http://archive.routeviews.org/bgpdata/</a>
), you can find ASNs and ranges - aha! this is where I can sort out if a range is inactive or not!</p>

<p>The data roughly looks like this when you dump it out with <code class="language-plaintext highlighter-rouge">bgpdump</code></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>TYPE      ?|  DATE    |?|FROM     |ASN |PREFIX    |ASNPATH   |ORG|NEXT_HOP |?|?|COMMUNITY
TABLE_DUMP2|1593640801|B|12.0.1.63|7018|8.8.8.0/24|7018 15169|IGP|12.0.1.63|0|0|7018:2500 7018:37232|NAG||
TABLE_DUMP2|1593640801|B|144.228.241.130|1239|8.8.8.0/24|1239 15169|IGP|144.228.241.130|0|80||NAG||
TABLE_DUMP2|1593640801|B|208.51.134.246|3549|8.8.8.0/24|3549 3356 15169|IGP|208.51.134.246|0|2504|3356:2 3356:86 3356:500 3356:666 3356:2064 3356:11078 3549:2352 3549:31826|NAG||
TABLE_DUMP2|1593640801|B|202.232.0.3|2497|8.8.8.0/24|2497 15169|IGP|202.232.0.3|0|0||NAG||
</code></pre></div></div>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Get outgoing IP and asn</span>
bgpdump <span class="nt">-m</span> rib.20200701.2200.bz2  | <span class="nb">cut</span> <span class="nt">-d</span><span class="s1">'|'</span> <span class="nt">-f</span> 4,5

<span class="c"># Find matches for a specific ASN</span>
bgpdump updates.20200428.1815 | <span class="nb">grep</span> <span class="s1">'AS6447'</span>
</code></pre></div></div>

<p>Parsing through a rib file you can find figure out what ASNs are associated with what ranges and are still active.</p>

<h2 id="conclusion">Conclusion</h2>
<p>So I’m still not concluded … but you can start to see how the pieces are coming together. I’m not clear on how you get specific states or cities, but that’s why things are not concluded.</p>

<h2 id="links">Links</h2>
<p>During my process of searching for data I always find useful looks that directly contributed to my discoveries or are related.</p>

<ul>
  <li><a href="https://host.io/">https://host.io/</a></li>
  <li><a href="https://blogofsomeguy.com/a/2017-07-26/fastmetrics-p4-mapping-ip-to-asn.html">https://blogofsomeguy.com/a/2017-07-26/fastmetrics-p4-mapping-ip-to-asn.html</a></li>
  <li><a href="https://github.com/t2mune/mrtparse/blob/master/examples/summary.py">https://github.com/t2mune/mrtparse/blob/master/examples/summary.py</a></li>
  <li><a href="https://ftp.ripe.net/ripe/ipmap/">https://ftp.ripe.net/ripe/ipmap/</a></li>
  <li><a href="https://asn.cymru.com/">https://asn.cymru.com/</a></li>
  <li><a href="https://www.iana.org/whois?q=67.187.185.36">https://www.iana.org/whois?q=67.187.185.36</a></li>
  <li><a href="https://search.arin.net/rdap/?query=67.187.185.36&amp;searchFilter=ipaddr">https://search.arin.net/rdap/?query=67.187.185.36&amp;searchFilter=ipaddr</a></li>
  <li><a href="https://team-cymru.com/community-services/ip-asn-mapping/">https://team-cymru.com/community-services/ip-asn-mapping/</a></li>
  <li><a href="http://rest.db.ripe.net/search?query-string=8.8.8.8&amp;type-filter=inetnum">http://rest.db.ripe.net/search?query-string=8.8.8.8&amp;type-filter=inetnum</a></li>
  <li><a href="https://hackertarget.com/as-ip-lookup/">https://hackertarget.com/as-ip-lookup/</a></li>
  <li><a href="https://rdap.arin.net/registry/ip/8.8.8.8">https://rdap.arin.net/registry/ip/8.8.8.8</a>
    <ul>
      <li>Look at <code class="language-plaintext highlighter-rouge">arin_originas0_originautnums</code> for ASN</li>
    </ul>
  </li>
  <li><a href="https://www.arin.net/resources/registry/whois/rdap/#rdap-urls">https://www.arin.net/resources/registry/whois/rdap/#rdap-urls</a></li>
  <li><a href="https://www.icann.org/rdap">https://www.icann.org/rdap</a></li>
</ul>

  </section>

  
</article>
      </div>
    </main>
    <footer id="site-footer">
  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1"></div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/rezen"><span class="icon icon--github"><svg viewBox="0 0 16 16" width="16px" height="16px"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/></svg>
</span><span class="username">rezen</span></a>

          </li>
          

          
          <li>
            <a href="https://twitter.com/dandr3ss"><span class="icon icon--twitter"><svg viewBox="0 0 16 16" width="16px" height="16px"><path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/></svg>
</span><span class="username">dandr3ss</span></a>

          </li>
          
        </ul>
      </div>

      <div class="footer-col footer-col-3">
        <p>Hi there, this is where I archive some of my brain records on development and design topics I&#39;ve been working through. Some of these thoughts are raw as I&#39;m evolving and others  are refined from years of experience.
</p>
      </div>
    </div>
  </div>
</footer>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
<script>
jQuery(function ($) {
  // Add anchors to headings that have ids
  // https://github.com/jekyll/jekyll/issues/2690#issuecomment-153697263
  $('h2,h3,h4,h5,h6').filter('[id]').each(function () {
    $(this).html('<a href="#'+$(this).attr('id')+'">' + $(this).text() + '</a>');
  });

  $('.menu-trigger').on('click', function () {
    $(this).next().toggleClass('expanded');
  });
});
</script>
  </body>
</html>